<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">

    </head>
    <body>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
        <script src="lib/underscore-min.js"></script>
        <script src="github.js"></script>
        <script src="jquery.cookie.js"></script>
        <script>
        $(document).ready(function() {
            var authProxy = "http://young-oasis-3292.herokuapp.com";
            function authenticate() {
                
              if ($.cookie("oauth-token")) return window.authenticated = true;
              var match = window.location.href.match(/\?code=([a-z0-9]*)/);

              // Handle Code
              if (match) {
                $.getJSON(authProxy+'/authenticate/'+match[1], function(data) {
                  $.cookie('oauth-token', data.token);
                  window.authenticated = true;
                  // Adjust URL
                  var regex = new RegExp("\\?code="+match[1]);
                  window.location.href = window.location.href.replace(regex, '').replace('&state=', '');
                });
                return false;
              } else {
                return true;  
              }
            }
            authenticate();


            $("#save").click(function(e) {
                var gh = new Github({token: $.cookie("oauth-token"),auth:"oauth",username:'jimmystridh'});
                var repo = gh.getRepo('jimmystridh', 'github-editing-lab');
                repo.write('master', 'testfile.txt', $('#editing').html(), 'Automatic commit from save.', function(err) {console.log(err)});
            });
        });
        </script>

        <p contenteditable="true" id="editing">Edit this plx.</p>
        <a href="javascript:void(0)" id="save">Save</a>
        <a class="button" href="https://github.com/login/oauth/authorize?client_id=818ef0f7c7750d07785a&scope=repo,user,gist">Authorize with GitHub</a>
    </body>
</html>